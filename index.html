<!doctype html>
<html lang="es">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Demo ‚Äî Evaluaci√≥n Flash (Python + SQL)</title>
    <link rel="icon" href="data:," />
    <style>
        /* --- Modern skeuomorphism theme --- */
        :root {
            --bg: #eef4fb;
            --card: #f8fbff;
            --accent: #5f6bff;
            --accent2: #7a6bff;
            --muted: #6b7280;
            --ok: #0b8a4a;
            --warn: #f57c00;
            --danger: #d32f2f;
            --round: 14px;
        }

        * {
            box-sizing: border-box
        }

        body {
            font-family: Inter, system-ui, Arial;
            background: linear-gradient(135deg, #eef6ff, #f7fbff);
            color: #132237;
            padding: 24px;
        }

        .wrap {
            max-width: 980px;
            margin: 0 auto;
            background: linear-gradient(180deg, #fbfdff, #f1f6ff);
            border-radius: 18px;
            padding: 20px;
            box-shadow: 0 18px 48px rgba(20, 30, 70, 0.06);
            border: 1px solid rgba(120, 140, 180, 0.04)
        }

        header {
            display: flex;
            gap: 12px;
            align-items: center
        }

        header h1 {
            font-size: 20px;
            margin: 0;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            -webkit-background-clip: text;
            color: transparent
        }

        header p {
            margin: 0;
            font-size: 13px;
            color: var(--muted)
        }

        .start {
            display: flex;
            gap: 16px;
            align-items: center;
            margin-top: 16px;
            flex-wrap: wrap
        }

        .field {
            background: var(--card);
            padding: 12px;
            border-radius: 12px;
            box-shadow: 8px 12px 26px rgba(70, 90, 140, 0.04);
            border: 1px solid rgba(120, 130, 160, 0.03)
        }

        label {
            display: block;
            font-size: 13px;
            color: var(--muted);
            margin-bottom: 6px
        }

        input[type="text"],
        input[type="email"],
        select {
            padding: 10px;
            border-radius: 10px;
            border: 1px solid rgba(120, 130, 160, 0.06);
            width: 260px
        }

        .modes {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap
        }

        .mode {
            padding: 10px 12px;
            border-radius: 12px;
            background: linear-gradient(180deg, #fff, #f6f9ff);
            cursor: pointer;
            border: 1px solid rgba(120, 130, 160, 0.06);
            box-shadow: 8px 10px 20px rgba(60, 80, 120, 0.04)
        }

        .mode.active {
            box-shadow: 0 20px 48px rgba(100, 110, 255, 0.08);
            border-color: rgba(100, 110, 255, 0.18)
        }

        .qstage {
            margin-top: 18px;
            display: none
        }

        .section-title {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 10px;
            background: linear-gradient(180deg, rgba(120, 130, 255, 0.08), rgba(120, 130, 255, 0.04));
            color: var(--accent2);
            font-weight: 700;
            margin-bottom: 10px
        }

        .qcard {
            background: linear-gradient(180deg, #fff, #f6fbff);
            padding: 16px;
            border-radius: 14px;
            box-shadow: 12px 18px 36px rgba(60, 80, 120, 0.04);
            border: 1px solid rgba(120, 130, 160, 0.03)
        }

        .qtext {
            font-size: 16px;
            margin-bottom: 12px
        }

        .choices {
            display: flex;
            flex-direction: column;
            gap: 8px
        }

        .choice {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px;
            border-radius: 10px;
            border: 1px solid rgba(120, 130, 160, 0.04);
            cursor: pointer;
            background: #fbfdff
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 14px;
            gap: 10px;
            flex-wrap: wrap
        }

        .btn {
            border: none;
            padding: 10px 14px;
            border-radius: 12px;
            font-weight: 700;
            cursor: pointer;
            background: linear-gradient(180deg, var(--accent), var(--accent2));
            color: white;
            box-shadow: 0 10px 26px rgba(70, 90, 200, 0.08)
        }

        .btn.ghost {
            background: transparent;
            color: var(--muted);
            border: 1px solid rgba(120, 130, 160, 0.06)
        }

        .progress {
            height: 12px;
            background: linear-gradient(90deg, #eef4ff, #f6f9ff);
            border-radius: 10px;
            overflow: hidden;
            border: 1px solid rgba(120, 130, 160, 0.03)
        }

        .progress>i {
            display: block;
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            border-radius: 10px;
            transition: width .35s
        }

        .timer {
            font-weight: 800;
            color: var(--accent2)
        }

        .report {
            margin-top: 16px;
            padding: 14px;
            border-radius: 12px;
            background: linear-gradient(180deg, #fff, #f7fbff);
            border: 1px solid rgba(120, 130, 160, 0.03);
            box-shadow: 12px 18px 30px rgba(60, 80, 120, 0.04)
        }

        .badge {
            padding: 6px 10px;
            border-radius: 999px;
            font-weight: 700
        }

        .badge.good {
            background: #e7fff0;
            color: #0b7a4e;
            border: 1px solid rgba(11, 122, 78, 0.06)
        }

        .badge.bad {
            background: #fff7ec;
            color: #b24f00;
            border: 1px solid rgba(178, 79, 0, 0.06)
        }

        .section-summaries {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 12px
        }

        .sbox {
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(180deg, #fff, #fbfdff);
            border: 1px solid rgba(120, 130, 160, 0.04);
            min-width: 220px
        }

        .sbox.good {
            border-color: rgba(11, 122, 78, 0.12);
            box-shadow: 0 8px 20px rgba(11, 122, 78, 0.04) inset
        }

        .sbox.bad {
            border-color: rgba(178, 79, 0, 0.10)
        }

        .wrong-list {
            margin-top: 10px
        }

        .medal {
            width: 48px;
            height: 48px;
            display: inline-block;
            vertical-align: middle
        }

        .small {
            font-size: 13px;
            color: var(--muted)
        }

        @media (max-width:720px) {
            .section-summaries {
                flex-direction: column
            }
        }
    </style>
</head>

<body>
    <div class="wrap">

        <header>
            <div>
                <h1>Evaluaci√≥n Flash ‚Äî Demo (Python + SQL)</h1>
                <p>Modo: una pregunta a la vez ¬∑ Cron√≥metro por pregunta</p>
            </div>
            <div style="margin-left:auto;text-align:right">
                <div class="small">Demo: 5 preguntas</div>
            </div>
        </header>

        <!-- START: Setup -->
        <div class="start" id="startPanel">
            <div class="field">
                <label for="nick">Nickname (obligatorio)</label>
                <input id="nick" type="text" placeholder="Ej. AdaLovelace">
            </div>

            <div class="field">
                <label>Modo por pregunta</label>
                <div class="modes" id="modeOptions">
                    <div class="mode active" data-mode="none" onclick="setMode(this)"><strong>Sin cron√≥metro</strong>
                        <div class="small">Libre</div>
                    </div>
                    <div class="mode" data-mode="5" onclick="setMode(this)"><strong>5 s</strong>
                        <div class="small">R√°pido</div>
                    </div>
                    <div class="mode" data-mode="10" onclick="setMode(this)"><strong>10 s</strong>
                        <div class="small">Intermedio</div>
                    </div>
                    <div class="mode" data-mode="15" onclick="setMode(this)"><strong>15 s</strong>
                        <div class="small">Moderado</div>
                    </div>
                    <div class="mode" data-mode="20" onclick="setMode(this)"><strong>20 s</strong>
                        <div class="small">Relajado</div>
                    </div>
                </div>
            </div>

            <div style="margin-left:auto;display:flex;flex-direction:column;gap:8px;align-items:flex-end">
                <button class="btn" id="startBtn" onclick="startQuiz()">üöÄ Comenzar</button>
                <div class="small">Las preguntas se barajar√°n.</div>
            </div>
        </div>
        <!-- END: Setup -->

        <!-- QUESTION STAGE -->
        <div class="qstage" id="stage">
            <div class="section-title" id="currentSection">Secci√≥n</div>

            <div class="qcard">
                <div style="display:flex;gap:12px;flex-wrap:wrap;">
                    <div style="flex:1;min-width:220px">
                        <div class="qtext" id="qText">Pregunta</div>
                        <div id="answerArea"></div>
                    </div>

                    <div style="width:220px;min-width:160px;">
                        <div class="small">Progreso</div>
                        <div style="display:flex;gap:8px;align-items:center">
                            <div class="progress" style="flex:1"><i id="progressBar"></i></div>
                            <div class="small" id="progressCount">0 / 0</div>
                        </div>

                        <div style="margin-top:12px">
                            <div class="small">Cron√≥metro por pregunta</div>
                            <div id="perTimer" class="timer">‚Äî</div>
                        </div>

                        <div style="margin-top:12px">
                            <div class="small">Sin responder = 0 puntos</div>
                        </div>
                    </div>
                </div>

                <div class="nav">
                    <div style="display:flex;gap:8px;align-items:center">
                        <button class="btn ghost" id="prevBtn" onclick="prevQ()" disabled>‚¨ÖÔ∏é Anterior</button>
                        <button class="btn ghost" id="nextBtn" onclick="nextQ()">Siguiente ‚ûú</button>
                    </div>

                    <div style="display:flex;gap:8px;align-items:center">
                        <button class="btn ghost" onclick="shuffleQuestions(true)">üîÄ Rebarajar</button>
                        <button class="btn" id="evalBtn" onclick="evaluateQuiz()">Evaluar</button>
                    </div>
                </div>

            </div>

            <!-- Report will appear here -->
            <div id="reportArea" style="display:none">
                <div class="report">
                    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
                        <div>
                            <h3 id="reportTitle">Informe ‚Äî Resultado</h3>
                            <div class="small" id="reportNick"></div>
                        </div>
                        <div>
                            <div id="reportScore" class="badge">0%</div>
                        </div>
                    </div>

                    <div id="reportMessage" class="small" style="margin-top:8px"></div>

                    <div class="section-summaries" id="sectionSummaries"></div>

                    <div id="wrongAnswers" class="wrong-list"></div>

                    <!-- Email + consent to submit -->
                    <div style="margin-top:12px;display:flex;gap:10px;align-items:center;flex-wrap:wrap;">
                        <div style="flex:1;min-width:220px">
                            <label for="email">Correo electr√≥nico (para recibir copia)</label>
                            <input id="email" type="email" placeholder="tu@correo.com">
                        </div>
                        <div style="min-width:220px">
                            <label style="display:flex;gap:8px;align-items:center"><input id="consent" type="checkbox">
                                Autorizo el env√≠o de mis resultados y recibir una copia por correo</label>
                        </div>
                        <div style="margin-left:auto">
                            <button class="btn" id="sendBtn" onclick="sendResults()" disabled>üì§ Enviar y guardar mis
                                resultados</button>
                        </div>
                    </div>

                </div>
            </div>

        </div>

    </div>

    <script>
        /* =========================
           Demo Quiz ‚Äî 5 questions (mix Python + SQL)
           Features:
           - One question at a time, shuffled
           - Per-question timer: none | 5 | 10 | 15 | 20
           - Partial credit for MC (no negative)
           - Unanswered = 0
           - Evaluate -> shows global score, per-section summary (GOOD/BAD)
           - After Evaluate: email + consent -> Submit to Google Form
           - Placeholders for Google Form config below
           ========================= */

        /* ---------- GOOGLE FORM CONFIG ----------
           Replace the placeholders below with your Google Form values.
           - GOOGLE_FORM_URL: the form's `.../formResponse` URL (not the viewform URL).
           - ENTRY_*: the entry IDs from the prefilled link (entry.XXXXXXXX).
           Steps to find them are included in the INSTRUCTOR SETUP comment at the end.
        */
        const GOOGLE_FORM_URL = "https://docs.google.com/forms/d/1sPc0Do7UO6q_J_oE18K6-MmZiBexNTtGm_TW7LqtGfk/formResponse"; // <-- replace
        const ENTRY_NICKNAME = "entry.717917255"; // <-- replace
        const ENTRY_EMAIL = "entry.527462807"; // <-- replace
        const ENTRY_SCORE = "entry.1067718162"; // <-- replace
        const ENTRY_SECTIONS = "entry.1519028634"; // <-- replace
        /* ----------------------------------------- */

        /* ---------- DEMO QUESTIONS ----------
           Each question has:
            id, section, type: 'mc'|'tf'|'fill'
            text, choices (for mc), correct
           For mc: correct is array of booleans (true for correct options)
           For tf: correct is 'verdadero'|'falso'
           For fill: correct is array of acceptable lowercase substrings OR null to accept any non-empty
        */
        const QUESTIONS = [
            {
                id: 'd1', section: 'Sintaxis', type: 'mc',
                text: '¬øCu√°l(es) de las siguientes son formas v√°lidas de definir una cadena en Python?',
                choices: [
                    { text: "'hola'" },
                    { text: '"hola"' },
                    { text: '`hola`' }
                ],
                correct: [true, true, false]
            },
            {
                id: 'd2', section: 'Sintaxis', type: 'tf',
                text: '(V/F) Las comillas triples se usan para cadenas multil√≠nea en Python.',
                correct: 'verdadero'
            },
            {
                id: 'd3', section: 'Listas y Conjuntos', type: 'mc',
                text: '¬øQu√© caracter√≠sticas distinguen un conjunto (set) de una lista?',
                choices: [
                    { text: 'Permite elementos duplicados' },
                    { text: 'Elementos √∫nicos' },
                    { text: 'Orden garantizado' }
                ],
                correct: [false, true, false]
            },
            {
                id: 'd4', section: 'SQL b√°sico', type: 'fill',
                text: 'Escribe la palabra SQL para seleccionar todas las columnas de una tabla (solo la palabra):',
                correct: ['select']
            },
            {
                id: 'd5', section: 'SQL b√°sico', type: 'mc',
                text: '¬øCu√°l cl√°usula se usa para filtrar filas en SQL?',
                choices: [
                    { text: 'ORDER BY' },
                    { text: 'WHERE' },
                    { text: 'GROUP BY' }
                ],
                correct: [false, true, false]
            }
        ];

        /* ---------- STATE ---------- */
        let modePerQuestion = 'none';
        let questions = [];
        let currentIndex = 0;
        let answers = {}; // keyed by id; mc => array of indices; tf => 'verdadero'/'falso'; fill => string
        let perTimerInterval = null;
        let perTimeLeft = 0;

        /* ---------- UI helpers ---------- */
        function setMode(el) {
            document.querySelectorAll('.mode').forEach(m => m.classList.remove('active'));
            el.classList.add('active');
            modePerQuestion = el.dataset.mode;
        }
        function startQuiz() {
            const nick = document.getElementById('nick').value.trim();
            if (!nick) {
                alert('Introduce tu nickname antes de comenzar.');
                return;
            }
            // shallow copy and shuffle
            questions = QUESTIONS.map(q => Object.assign({}, q));
            shuffleArray(questions);
            currentIndex = 0;
            answers = {};
            document.getElementById('startPanel').style.display = 'none';
            document.getElementById('stage').style.display = 'block';
            document.getElementById('reportArea').style.display = 'none';
            renderCurrent();
        }
        function shuffleQuestions(preservePosition) {
            shuffleArray(questions);
            if (!preservePosition) currentIndex = 0;
            renderCurrent();
        }
        function shuffleArray(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
        }

        /* ---------- render ---------- */
        function renderCurrent() {
            clearPerTimer();
            const q = questions[currentIndex];
            if (!q) return;
            document.getElementById('currentSection').textContent = q.section;
            document.getElementById('qText').textContent = q.text;
            const area = document.getElementById('answerArea');
            area.innerHTML = '';

            if (q.type === 'mc') {
                const container = document.createElement('div'); container.className = 'choices';
                q.choices.forEach((c, idx) => {
                    const lab = document.createElement('label'); lab.className = 'choice';
                    lab.innerHTML = `<input type="checkbox" data-q="${q.id}" data-idx="${idx}"> <div style="flex:1">${c.text}</div>`;
                    const cb = lab.querySelector('input');
                    if (answers[q.id] && answers[q.id].includes(idx)) cb.checked = true;
                    cb.addEventListener('change', () => {
                        const checked = Array.from(container.querySelectorAll('input:checked')).map(i => +i.dataset.idx);
                        answers[q.id] = checked;
                    });
                    container.appendChild(lab);
                });
                area.appendChild(container);
            } else if (q.type === 'tf') {
                const container = document.createElement('div'); container.className = 'choices';
                ['verdadero', 'falso'].forEach(opt => {
                    const lab = document.createElement('label'); lab.className = 'choice';
                    lab.innerHTML = `<input type="radio" name="${q.id}" value="${opt}"> <div style="flex:1">${opt[0].toUpperCase() + opt.slice(1)}</div>`;
                    const rb = lab.querySelector('input');
                    if (answers[q.id] && answers[q.id] === opt) rb.checked = true;
                    rb.addEventListener('change', () => answers[q.id] = rb.value);
                    container.appendChild(lab);
                });
                area.appendChild(container);
            } else if (q.type === 'fill') {
                const input = document.createElement('input'); input.className = 'field'; input.type = 'text'; input.placeholder = 'Tu respuesta...';
                input.style.width = '100%';
                input.value = answers[q.id] || '';
                input.addEventListener('input', () => answers[q.id] = input.value.trim());
                area.appendChild(input);
            }

            // progress
            document.getElementById('progressCount').textContent = `${currentIndex + 1} / ${questions.length}`;
            document.getElementById('progressBar').style.width = `${Math.round(((currentIndex) / questions.length) * 100)}%`;
            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === questions.length - 1;

            startPerTimer();
        }

        /* ---------- navigation ---------- */
        function nextQ() { saveCurrentInput(); if (currentIndex < questions.length - 1) { currentIndex++; renderCurrent(); } }
        function prevQ() { saveCurrentInput(); if (currentIndex > 0) { currentIndex--; renderCurrent(); } }
        function saveCurrentInput() {
            const q = questions[currentIndex];
            if (!q) return;
            if (q.type === 'fill') {
                const txt = document.querySelector('#answerArea input');
                if (txt) answers[q.id] = txt.value.trim();
            } else if (q.type === 'mc') {
                const checked = Array.from(document.querySelectorAll('#answerArea input[type="checkbox"]:checked')).map(i => +i.dataset.idx);
                if (checked.length) answers[q.id] = checked;
            } else if (q.type === 'tf') {
                const rb = document.querySelector('#answerArea input[type="radio"]:checked');
                if (rb) answers[q.id] = rb.value;
            }
        }

        /* ---------- per-question timer ---------- */
        function startPerTimer() {
            clearPerTimer();
            const el = document.getElementById('perTimer');
            if (modePerQuestion === 'none') {
                el.textContent = '‚Äî';
                return;
            }
            perTimeLeft = parseInt(modePerQuestion, 10);
            el.textContent = `‚è± ${perTimeLeft}s`;
            perTimerInterval = setInterval(() => {
                perTimeLeft--;
                el.textContent = `‚è± ${perTimeLeft}s`;
                if (perTimeLeft <= 0) {
                    clearPerTimer();
                    // auto-advance; unanswered stays as is (0)
                    if (currentIndex < questions.length - 1) { currentIndex++; renderCurrent(); } else { evaluateQuiz(); }
                }
            }, 1000);
        }
        function clearPerTimer() { if (perTimerInterval) { clearInterval(perTimerInterval); perTimerInterval = null; } }

        /* ---------- scoring & evaluation ---------- */
        function evaluateQuiz() {
            saveCurrentInput();
            clearPerTimer();

            const totalQuestions = questions.length;
            let totalPoints = 0; // sum of per-question points (each max 1.0)
            let maxPoints = totalQuestions; // total max

            // per-section aggregation
            const sections = {}; // {section: {questions:[], points:0, max:0, correctCountFull:0}}
            questions.forEach(q => {
                if (!sections[q.section]) sections[q.section] = { questions: [], points: 0, max: 0, correctFull: 0 };
                sections[q.section].questions.push(q);
                sections[q.section].max += 1;
            });

            const wrong = [];

            questions.forEach(q => {
                const user = answers[q.id];
                let qpoints = 0;

                if (q.type === 'mc') {
                    // if user empty -> 0
                    if (!Array.isArray(user) || user.length === 0) { qpoints = 0; }
                    else {
                        const correctIdx = q.correct.map((v, i) => v ? i : null).filter(i => i !== null);
                        const correctlySelected = user.filter(i => correctIdx.includes(i)).length;
                        qpoints = correctIdx.length ? (correctlySelected / correctIdx.length) : 0;
                        // cap to 1.0
                        if (qpoints > 1) qpoints = 1;
                        // round 1 decimal
                        qpoints = Math.round(qpoints * 10) / 10;
                    }
                } else if (q.type === 'tf') {
                    qpoints = (!!user && user.toLowerCase() === q.correct.toLowerCase()) ? 1 : 0;
                } else if (q.type === 'fill') {
                    if (!user || user.trim() === '') { qpoints = 0; }
                    else if (q.correct === null) { qpoints = 1; }
                    else {
                        const u = user.toLowerCase();
                        const match = q.correct.some(c => u.includes(c.toLowerCase()) || c.toLowerCase().includes(u));
                        qpoints = match ? 1 : 0;
                    }
                }

                totalPoints += qpoints;
                sections[q.section].points += qpoints;
                if (qpoints >= 1) sections[q.section].correctFull += 1; // full correct answers count
                // if wrong, push to list
                if (qpoints < 1) {
                    wrong.push({
                        id: q.id, section: q.section, text: q.text,
                        your: (user === undefined || user === null || (Array.isArray(user) && user.length === 0)) ? '(sin responder)' : (Array.isArray(user) ? user.map(i => (q.choices && q.choices[i] ? q.choices[i].text : i)).join(', ') : user),
                        expected: expectedReadable(q),
                        points: qpoints
                    });
                }
            });

            const pct = Math.round((totalPoints / maxPoints) * 100);
            showReport(totalPoints, maxPoints, pct, sections, wrong);

            // prepare data for potential automatic send (but we send only when user clicks send)
        }

        /* pretty expected */
        function expectedReadable(q) {
            if (q.type === 'mc') {
                return q.choices.map((c, i) => q.correct[i] ? c.text : null).filter(Boolean).join(' ‚Äî ');
            } else if (q.type === 'tf') return q.correct;
            else if (Array.isArray(q.correct)) return q.correct.join(' / ');
            else return '(respuesta esperada)';
        }

        /* ---------- report UI ---------- */
        function showReport(totalPoints, maxPoints, pct, sections, wrong) {
            document.getElementById('reportArea').style.display = 'block';
            document.getElementById('reportNick').textContent = 'Nickname: ' + document.getElementById('nick').value.trim();
            const scoreEl = document.getElementById('reportScore');
            scoreEl.textContent = `${Math.round((totalPoints / maxPoints) * 100)}%`;

            // overall message and badge color
            const msgEl = document.getElementById('reportMessage');
            if ((totalPoints / maxPoints) >= 0.9) msgEl.textContent = '¬°Excelente! Gran dominio de los conceptos.';
            else if ((totalPoints / maxPoints) >= 0.7) msgEl.textContent = 'Buen trabajo ‚Äî algunas preguntas para repasar.';
            else {
                msgEl.textContent = 'No te rindas ‚Äî practica m√°s y volver√°s a mejorar. No et rendeixis. Don‚Äôt give up!';
            }

            // sections summary boxes
            const ss = document.getElementById('sectionSummaries');
            ss.innerHTML = '';
            Object.keys(sections).forEach(sec => {
                const s = sections[sec];
                // per spec: <4 correct answers in section => BAD (orange). >=4 => GOOD (green)
                const status = s.correctFull >= 4 ? 'GOOD' : 'BAD';
                const pctSec = Math.round((s.points / s.max) * 100);
                const box = document.createElement('div'); box.className = 'sbox ' + (status === 'GOOD' ? 'good' : 'bad');
                box.innerHTML = `<div style="display:flex;align-items:center;gap:10px">
      ${getMedalSVG(pctSec > 75)}
      <div><strong>${sec}</strong><div class="small">${s.correctFull} correctas (puntos: ${Math.round(s.points * 10) / 10} / ${s.max})</div></div>
    </div>`;
                ss.appendChild(box);
            });

            // wrong answers list
            const wa = document.getElementById('wrongAnswers');
            wa.innerHTML = '';
            if (wrong.length === 0) {
                wa.innerHTML = '<div style="margin-top:8px;color:#0b7a4e;font-weight:700">Todas las respuestas correctas ‚úÖ</div>';
            } else {
                const hdr = document.createElement('div'); hdr.innerHTML = `<div style="font-weight:700;margin-top:8px">Preguntas incorrectas (${wrong.length}):</div>`; wa.appendChild(hdr);
                wrong.forEach(w => {
                    const el = document.createElement('div'); el.style.padding = '10px'; el.style.marginTop = '8px'; el.style.borderRadius = '10px'; el.style.background = 'linear-gradient(180deg,#fff,#fbfdff)'; el.style.border = '1px solid rgba(120,130,160,0.04)';
                    el.innerHTML = `<div style="font-weight:700">${w.section} ‚Äî ${w.text}</div>
        <div class="small" style="margin-top:6px"><strong>Tu respuesta:</strong> ${escapeHtml(w.your)}</div>
        <div class="small"><strong>Esperado:</strong> ${escapeHtml(w.expected)}</div>
        <div class="small"><strong>Puntos obtenidos:</strong> ${w.points}</div>`;
                    wa.appendChild(el);
                });
            }

            // enable send button when consent + email ok
            const emailInput = document.getElementById('email'), consent = document.getElementById('consent');
            function updateSendBtn() {
                const ok = emailInput.value.trim() && consent.checked;
                document.getElementById('sendBtn').disabled = !ok;
            }
            emailInput.addEventListener('input', updateSendBtn);
            consent.addEventListener('change', updateSendBtn);

            // save latest evaluation in a global object for sending
            window.__lastEval = { totalPoints, maxPoints, pct: Math.round((totalPoints / maxPoints) * 100), sections, wrong };
        }

        /* ---------- sending to Google Form ---------- */
        function sendResults() {
            const cfg = { url: GOOGLE_FORM_URL, entryNick: ENTRY_NICKNAME, entryEmail: ENTRY_EMAIL, entryScore: ENTRY_SCORE, entrySections: ENTRY_SECTIONS };
            // basic validation
            const nick = document.getElementById('nick').value.trim();
            const email = document.getElementById('email').value.trim();
            const consent = document.getElementById('consent').checked;
            if (!nick || !email || !consent) {
                alert('Introduce nickname, correo y marca la casilla de consentimiento.');
                return;
            }
            if (!cfg.url.includes('forms')) { alert('Por favor, configure la URL del Google Form en el c√≥digo.'); return; }

            const s = window.__lastEval;
            if (!s) { alert('No hay resultados para enviar. Eval√∫a el test primero.'); return; }

            const sectionSummary = {};
            Object.keys(s.sections).forEach(k => { const v = s.sections[k]; sectionSummary[k] = `${v.correctFull} correctas (puntos: ${Math.round(v.points * 10) / 10} / ${v.max})`; });

            // prepare form-encoded payload
            const data = new URLSearchParams();
            data.append(cfg.entryNick, nick);
            data.append(cfg.entryEmail, email);
            data.append(cfg.entryScore, s.pct.toString());
            data.append(cfg.entrySections, JSON.stringify(sectionSummary));

            // send (no redirect)
            fetch(cfg.url, { method: 'POST', body: data, mode: 'no-cors' }) // no-cors prevents JS seeing response, but sends data
                .then(() => {
                    alert('‚úÖ Resultados enviados. Revisa tu correo (incl. carpeta Spam) si tienes la opci√≥n habilitada en el formulario.');
                    document.getElementById('sendBtn').disabled = true;
                })
                .catch(e => {
                    console.error('Error al enviar:', e);
                    alert('Error al enviar resultados. Comprueba la URL del formulario.');
                });
        }

        /* ---------- utilities ---------- */
        function escapeHtml(s) { return String(s).replace(/[&<>"]/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;' }[c])); }

        /* Medal SVG (skeuomorphic); earned=true => gold, else grey */
        function getMedalSVG(earned) {
            if (earned) {
                return `<svg class="medal" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="g1" cx="30%" cy="30%"><stop offset="0%" stop-color="#fff9d6"/><stop offset="60%" stop-color="#ffd24a"/><stop offset="100%" stop-color="#e6a600"/></radialGradient>
        <filter id="s1" x="-20%" y="-20%" width="150%" height="150%"><feDropShadow dx="0" dy="4" stdDeviation="4" flood-color="#000" flood-opacity="0.12"/></filter>
      </defs>
      <g filter="url(#s1)">
        <circle cx="32" cy="22" r="12" fill="url(#g1)" stroke="#e6a600" stroke-width="1.5"/>
        <path d="M10 6 L22 22 L14 22 Z" fill="#f0c02e"/>
        <path d="M54 6 L42 22 L50 22 Z" fill="#f0c02e"/>
        <rect x="24" y="34" width="16" height="24" rx="6" fill="#fff" opacity="0.04"/>
      </g>
    </svg>`;
            } else {
                return `<svg class="medal" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg">
      <defs>
        <radialGradient id="g2" cx="30%" cy="30%"><stop offset="0%" stop-color="#f6f7f9"/><stop offset="80%" stop-color="#cfd4da"/></radialGradient>
      </defs>
      <g>
        <circle cx="32" cy="22" r="12" fill="url(#g2)" stroke="#bfc6cf" stroke-width="1.2"/>
        <path d="M10 6 L22 22 L14 22 Z" fill="#d7dbe0"/>
        <path d="M54 6 L42 22 L50 22 Z" fill="#d7dbe0"/>
      </g>
    </svg>`;
            }
        }

        /* ---------- init ---------- */
        (function init() { modePerQuestion = 'none'; })();

    </script>

    <!-- =======================
     INSTRUCTOR SETUP (TRILINGUAL)
     These comments explain how to obtain the Google Form URL and entry IDs,
     and how to enable "Collect email addresses" + "Send responders a copy".
     They are intentionally included in three languages for your convenience.
     =======================

ESPA√ëOL:
1) Crea un formulario en https://forms.google.com con campos:
   - Nickname (Respuesta corta)
   - Email (Respuesta corta)
   - Total Score (%) (Respuesta corta)
   - Section Summary (Respuesta larga)
2) En "Configuraci√≥n" activa: "Recopilar direcciones de correo" y "Enviar a los encuestados una copia de sus respuestas".
3) Para obtener las entradas 'entry.XXXXXXX':
   - En el editor del formulario, pulsa "Obtener enlace de relleno" (Get pre-filled link).
   - Rellena con datos de prueba y copia el link generado.
   - En el link ver√°s par√°metros como &entry.1234567890=valor. Copia cada 'entry.XXXXXXXX' para usarlo abajo.
4) En el c√≥digo m√°s arriba, reemplaza:
   - GOOGLE_FORM_URL con la URL que termina en /formResponse
   - ENTRY_NICKNAME / ENTRY_EMAIL / ENTRY_SCORE / ENTRY_SECTIONS con tus entry. IDs
5) Publica el archivo en GitHub Pages y prueba. Cuando el usuario pulse "Enviar y guardar mis resultados",
   el formulario recibir√° los datos y Google enviar√° al alumno una copia autom√°tica (si la opci√≥n est√° activada).

CATAL√Ä:
1) Crea un formulari a https://forms.google.com amb camps:
   - Nickname (Resposta curta)
   - Email (Resposta curta)
   - Total Score (%) (Resposta curta)
   - Section Summary (Resposta llarga)
2) A "Configuraci√≥" activa: "Recopilar adreces de correu electr√≤nic" i "Enviar una c√≤pia de les respostes als respondents".
3) Per obtenir les entrades 'entry.XXXXXXX':
   - A l'editor, fes clic a "Obtenir enlla√ß omplert pr√®viament".
   - Omple amb dades de prova i copia l'enlla√ß generat.
   - A l'enlla√ß veur√†s par√†metres &entry.1234567890=valor. Copia cada 'entry.XXXXXXXX' per utilitzar-los al codi.
4) Al codi, substitueix:
   - GOOGLE_FORM_URL per la URL que acaba en /formResponse
   - ENTRY_NICKNAME / ENTRY_EMAIL / ENTRY_SCORE / ENTRY_SECTIONS amb els teus entry. IDs
5) Publica a GitHub Pages i prova. En pr√©mer "Enviar i desar els meus resultats", el formulari rebr√† les dades i Google enviar√† una c√≤pia al participant (si s'ha activat).

ENGLISH:
1) Create a Google Form at https://forms.google.com with fields:
   - Nickname (Short answer)
   - Email (Short answer)
   - Total Score (%) (Short answer)
   - Section Summary (Paragraph)
2) In Settings enable: "Collect email addresses" and "Send responders a copy of their responses".
3) To get 'entry.XXXXXXX' field IDs:
   - In the form editor click "Get pre-filled link".
   - Fill sample values and copy the generated link.
   - In that link you will see parameters like &entry.1234567890=sample. Copy each 'entry.XXXXXXXX' for the code.
4) In the code above replace:
   - GOOGLE_FORM_URL with the formResponse URL (ends with /formResponse)
   - ENTRY_NICKNAME / ENTRY_EMAIL / ENTRY_SCORE / ENTRY_SECTIONS with your entry. IDs
5) Deploy to GitHub Pages and test. When the user clicks "Enviar y guardar mis resultados", the form will capture the data and Google will send an automatic copy to the respondent (if enabled).

=======================
END OF INSTRUCTOR SETUP -->
</body>

</html>